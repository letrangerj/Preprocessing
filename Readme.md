# Image Processing Workflow

**Note: This README.md file was generated by an AI assistant based on the provided Python scripts and ImageJ macro, revised by Long.**

This workflow consists of four main steps for processing and organizing microscopy images. Below is a detailed explanation of each step and the resulting file structure changes.

The input of the preprocessing workflow comes directly from microscopy exports, and the resulting file arrangement can be used for *downstream analysis of Cell Detection*.

Note the naming for each microscopy image, the file should contain

1. The treatment (WT/EZH2...)

2. The number of single cell clones

3. The number of frame for each clones

## Workflow Overview

1. Move files containing certain strings (0_Move_files.py)
2. Organize and rename files (1_Name_process_compressed_simplify.py)
3. Merge and color channels (2_Merge_Batch.ijm)
4. Organize merged images for analysis (3_Move_Formal.py)

## Detailed Workflow

### Step 1: Move Files (0_Move_files.py)

This script moves files containing a specific string in their name to a new folder.

**Input:**

- Source folder containing .tif files
- String to search for in file names (Typically the treatment, in the case of example data, it should be "WT"/"EZH2"/DNMT")

**Output:**

- New subfolder named after the search string, containing matching .tif filess

**File Structure Change:**

```
src_folder/
├── file1.tif
├── file2.tif
├── ...
└── string/
    ├── file_with_string.tif
    └── ...
```

### Step 2: Organize and Rename Files (1_Name_process_compressed_simplify.py)

This script organizes files into subfolders based on cell types and channels, then renames them.

**Input:**

- User-selected directory containing image files
- Number of fluorescent channels
- Number of cell types

**Output:**

- Organized folder structure with renamed files
- In this case, -1-1 means the 1st frame of 1st clone, -10-2 means the 2nd frame of 10th clone, etc. The clone and frame information should be noted when doing the microscopy.

**File Structure Change:**

```
selected_directory/
├── -1-1/
│   ├── Channel0/
│   │   ├── 0ch0.png
│   │   └── ...
│   ├── Channel1/
│   │   ├── 0ch1.png
│   │   └── ...
│   └── Merge/
├── -1-2/
│   └── ...
├── -2-1/
│   └── ...
└── ...
```

### Step 3: Merge and Color Channels (2_Merge_Batch.ijm)

This ImageJ macro colors individual channel images and merges them.

This macro can only run in ImageJ, please put this file under ~/Fiji.app/macros/toolsets/ (the path you store your ImageJ program).

**Input:**

- Directory with subfolders containing channel images (output from Step 2)

**Output:**

- Colored individual channel images
- Merged images for each frame
- Optional: Z-projected stack of merged images

**File Structure Change:**

```
input_directory/
├── -1-1/
│   ├── Channel0/
│   ├── Channel1/
│   └── Merge/
│       ├── Blue0ch0.png
│       ├── Red0ch1.png
│       ├── 0.png (merged)
│       └── ...
├── -1-2/
│   └── ...
└── ...
Stacked.png (optional, in parent directory)
```

### Step 4: Organize Merged Images (3_Move_Formal.py)

This script organizes the merged images into a structure suitable for analysis.

**Input:**

- Source directory (output from Step 3)s
- Destination directory for analysis
- Round number

**Output:**

- Organized folder structure for analysis

**File Structure Change:**

```
destination_directory/
├── frame_0/
│   └── R1/
│       ├── 0.png
│       ├── xxxch0.png
│       └── ...
├── frame_1/
│   └── R1/
│       └── ...
└── ...
```

## Usage

1. Run `0_Move_files.py` to initially organize your .tif files.
2. Execute `1_Name_process_compressed_simplify.py` to further organize and rename your files.
3. Use ImageJ to run the `2_Merge_Batch.ijm` macro for coloring and merging channels.
4. Finally, run `3_Move_Formal.py` to organize the merged images for analysis.

Make sure to follow the prompts in each script to provide the necessary input, such as directory paths, number of channels, and cell types.

## Requirements

- Python 3.x
- ImageJ with the ability to run macros
- Required Python libraries: `os`, `shutil`, `tkinter`

## Notes

- Ensure that your initial file naming convention is consistent for the scripts to work correctly.
- The ImageJ macro allows for customization of channel colors and merge options.
- Always verify the output at each step before proceeding to the next one.